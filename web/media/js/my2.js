/** @jsx React.DOM */
var fake = [
    {
        "id": 0,
        "author": "motorola-xoom-with-wi-fi",
        "name": "motorola-xoom-with-wi-fi.0.jpg",
        "genre": "rock",
        "year": "2001"
    },
    {
        "id": 1,
        "author": "motorola-xoom",
        "name": "motorola-xoom.0.jpg",
        "genre": "blues",
        "year": "2000"
    },
    {
        "id": 2,
        "author": "motorola-atrix-4g",
        "name": "motorola-atrix-4g.0.jpg",
        "genre": "folk",
        "year": "2001"
    },
    {
        "id": 3,
        "author": "dell-streak-7",
        "name": "dell-streak-7.0.jpg",
        "genre": "folk",
        "year": "2001"
    },
    {
        "id": 4,
        "author": "samsung-gem",
        "name": "samsung-gem.0.jpg",
        "genre": "jazz",
        "year": "2000"
    },
    {
        "id": 5,
        "author": "dell-venue",
        "name": "dell-venue.0.jpg",
        "genre": "jazz",
        "year": "2000"
    },
    {
        "id": 6,
        "author": "nexus-s",
        "name": "nexus-s.0.jpg",
        "genre": "classic",
        "year": "2000"
    },
    {
        "id": 7,
        "author": "lg-axis",
        "name": "lg-axis.0.jpg",
        "genre": "rock",
        "year": "2000"
    },
    {
        "id": 8,
        "author": "Ledd Zeppelin",
        "name": "samsung-galaxy-tab.0.jpg",
        "genre": "blues",
        "year": "2000"
    },
    {
        "id": 9,
        "author": "samsung-showcase-a-galaxy-s-phone",
        "name": "samsung-showcase-a-galaxy-s-phone.0.jpg",
        "genre": "jazz",
        "year": "2010"
    },
    {
        "id": 10,
        "author": "droauthor-2-global-by-motorola",
        "name": "droauthor-2-global-by-motorola.0.jpg",
        "genre": "folk",
        "year": "2012"
    },
    {
        "id": 11,
        "author": "droauthor-pro-by-motorola",
        "name": "droauthor-pro-by-motorola.0.jpg",
        "genre": "classic",
        "year": "1986"
    },
    {
        "id": 12,
        "author": "motorola-bravo-with-motoblur",
        "name": "motorola-bravo-with-motoblur.0.jpg",
        "genre": "miditation",
        "year": "1982"
    },
    {
        "id": 13,
        "author": "motorola-defy-with-motoblur",
        "name": "motorola-defy-with-motoblur.0.jpg",
        "genre": "ambient",
        "year": "1966"
    },
    {
        "id": 14,
        "author": "t-mobile-mytouch-4g",
        "name": "t-mobile-mytouch-4g.0.jpg",
        "genre": "chillout",
        "year": "1999"
    },
    {
        "id": 15,
        "author": "samsung-mesmerize-a-galaxy-s-phone",
        "name": "samsung-mesmerize-a-galaxy-s-phone.0.jpg",
        "genre": "rock",
        "year": "2001"
    },
    {
        "id": 16,
        "author": "sanyo-zio",
        "name": "sanyo-zio.0.jpg",
        "genre": "classic",
        "year": "2010"
    },
    {
        "id": 17,
        "author": "samsung-transform",
        "name": "samsung-transform.0.jpg",
        "genre": "jazz",
        "year": "2015"
    },
    {
        "id": 18,
        "author": "t-mobile-g2",
        "name": "t-mobile-g2.0.jpg",
        "genre": "jazz",
        "year": "2000"
    },
    {
        "id": 19,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 20,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 21,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 22,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 23,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 24,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 25,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 26,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 27,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 28,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 29,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 30,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 31,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 32,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 33,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    },
    {
        "id": 34,
        "author": "motorola-charm-with-motoblur",
        "name": "motorola-charm-with-motoblur.0.jpg",
        "genre": "folk",
        "year": "2010"
    }
];



var Grid = React.createClass({
    render(){
        return (
            <Griddle results={this.props.r} columnMetadata={columnMeta} rowMetadata={rowMeta} tableClassName="table"
                     showFilter={true} showSettings={true} resultsPerPage={10}
                     columns={["author", "name", "genre", "year"]}/>
        )
    }
});

var BabyNames = React.createClass({
    render() {
        d = [];
        //this.props.filter - значение атрибута
        //this.props.name - имя атрибута
        filter = this.props.filter.toLowerCase();
        name = this.props.name;
        // looping through each entry in the data array
        fake.map(function (person) {
            // only display names that match current input string
            cat = person.name;

            if (name == 'genre') {
                cat = person.genre;
            }
            if (name == 'year') {
                cat = person.year;
            }

            if (!cat.toLowerCase().indexOf(filter)) {
                d[d.length] = {
                    "author": person.author,
                    "name": person.name,
                    "genre": person.genre,
                    "id": person.id,
                    "year": person.year
                };
            }

        });
        if (d !== fake) {
            return (
                <Grid r={d}/>
            )
        } else {
            return (
                <Grid r={fake}/>
            )
        }

    }
});

var Filter = React.createClass({


    filterTrigger() {
        this.props.filterUpdate(this.refs.filterInput.name, this.refs.filterInput.value);
    },
    filterG() {
        this.props.filterUpdate(this.refs.filterGenre.name, this.refs.filterGenre.value);
    },
    filterY() {
        this.props.filterUpdate(this.refs.filterYear.name, this.refs.filterYear.value);
    },
    render() {

        var a = [];
        var b = [];
        fake.map(function (l) {
            a[l.id] = l.genre;
            b[l.id] = l.year;
        });
        genre = unique(a);
        year = unique(b.sort());

        return (
            <form>
                <label for="name">название</label><br />
                <input type="text"
                       name="name"
                       ref="filterInput"
                       placeholder="Type to filter.."
                    /* binding the input value to state */
                       onChange={ this.filterTrigger }/>

                <label for="genre">жанр</label><br />
                <select name="genre" ref="filterGenre" id="genre" onChange={ this.filterG }>
                    {
                        genre.map(function (l) {
                            return <option value={l}>{l}</option>
                        })
                    }
                </select>
                <br />
                <label for="year">год</label><br />
                <select name="year" ref="filterYear" onChange={ this. filterY}>
                    {
                        year.map(function (l) {
                            return <option value={l}>{l}</option>
                        })
                    }
                </select>
                <br/>
            </form>
        )
    }
});

var App = React.createClass({
    getInitialState() {
        return {
            filterName: '',
            filterText: ''
        }
    },
    // the 'value' param below = value of input field, sent from Filter component via the filterTrigger method
    stateUpdate(name, value) {
        //console.log(name);
        this.setState({
            filterName: name,
            filterText: value
        });
    },

    render() {
        return (
            <table width="100%">
                <tr>
                    <td>
                        <BabyNames filter={this.state.filterText} name={this.state.filterName}/>
                    </td>
                    <td class="test">
                        <Filter filterUpdate={this.stateUpdate}/>
                    </td>
                </tr>
            </table>
        )
    }
});


React.render(
    <App />,
    document.getElementById('wrapper')
);